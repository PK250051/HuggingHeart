let userName = "";
let currentGirlData = null;

async function startChatEngine(girl) {
    currentGirlData = girl;
    const display = document.getElementById('chat-display');
    display.innerHTML = ""; // Clear chat
    
    await botReply(`Hai! I am ${girl.name}. ðŸŒ¸ It is so nice to meet you. Before we start, what is your name?`);
}

async function botReply(text) {
    const status = document.getElementById('typing-status');
    const display = document.getElementById('chat-display');
    
    status.innerText = "Typing...";
    
    const msgDiv = document.createElement('div');
    msgDiv.className = "bot-msg";
    display.appendChild(msgDiv);
    
    const words = text.split(" ");
    for (let i = 0; i < words.length; i++) {
        msgDiv.innerText += words[i] + " ";
        display.scrollTop = display.scrollHeight;
        await new Promise(r => setTimeout(r, 100)); // Word speed
    }
    
    status.innerText = "Online";
}

async function sendMessage() {
    const input = document.getElementById('user-input');
    const val = input.value.trim();
    if (!val) return;

    const display = document.getElementById('chat-display');
    const uMsg = document.createElement('div');
    uMsg.className = "user-msg";
    uMsg.innerText = val;
    display.appendChild(uMsg);
    
    input.value = "";
    document.getElementById('suggestion-box').style.display = 'none';

    if (!userName) {
        userName = val;
        await botReply(`Nice to meet you, ${userName}! How can I help you today?`);
    } else {
        // Here you will later add the CSV logic to find real answers
        await botReply("That is very interesting... tell me more about that?");
    }
}

function handleTyping(val) {
    const box = document.getElementById('suggestion-box');
    if (val.length > 2) {
        // Example suggestion - you can link this to PQ_Master_List later
        box.innerHTML = `<div class="sugg-item" onclick="useSugg('How are you today?')">How are you today?</div>`;
        box.style.display = 'block';
    } else {
        box.style.display = 'none';
    }
}

function useSugg(text) {
    document.getElementById('user-input').value = text;
    sendMessage();
}
